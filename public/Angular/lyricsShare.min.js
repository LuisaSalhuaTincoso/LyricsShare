(function(){angular.module("lyricsShareApp",["ngRoute","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/detalle/:publishid",{templateUrl:"/publishDetail/publishDetail.view.html",controller:"publishDetailCtrl",controllerAs:"vm"}).when("/registro",{templateUrl:"/auth/register/register.view.html",controller:"registroCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/crear",{templateUrl:"/publishCreate/publishCreate.view.html",controller:"publishCreateCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("lyricsShareApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("lyricsShareApp").controller("homeCtrl",e);e.$inject=["$scope","lyricsShareData"];function e(e,t){var r=this;r.pageHeader={title:"Loc8r",strapline:"Find places to work with wifi near you!"};r.sidebar={content:"Looking for wifi and a seat etc etc"};r.message="Checking your location";r.message="Searching for nearby places";t.listPublishById().success(function(e){r.message=e.length>0?"":"No publish found nearby";r.data={publish:e}}).error(function(e){r.message="Sorry, something's gone wrong"})}})();(function(){angular.module("lyricsShareApp").controller("registroCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.pageHeader={title:"Create a new Loc8r account"};r.credentials={user_name:"",email:"",password:""};r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.user_name||!r.credentials.email||!r.credentials.password){r.formError="All fields required, please try again";return false}else{r.doRegister()}};r.doRegister=function(){r.formError="";t.register(r.credentials).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})}}})();(function(){angular.module("lyricsShareApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.pageHeader={title:"Sign in to Loc8r"};r.credentials={email:"",password:""};r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.email||!r.credentials.password){r.formError="All fields required, please try again";return false}else{r.doLogin()}};r.doLogin=function(){r.formError="";t.login(r.credentials).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})}}})();(function(){angular.module("lyricsShareApp").controller("publishDetailCtrl",e);e.$inject=["$routeParams","$location","$modal","lyricsShareData"];function e(e,t,r,o){var n=this;n.publishid=e.publishid;o.publishById(n.publishid).success(function(e){n.data={publish:e};n.pageHeader={title:n.data.publish.song.titulo}}).error(function(e){console.log(e)});n.onCommentSubmit=function(e){n.formError="";if(!n.formCommentData.post){n.formError="All fields required, please try again";return false}else{n.doAddComment(n.publishid,n.formCommentData,e)}n.formCommentData.post=""};n.doAddComment=function(e,t,r){o.createComment(e,{post:t.post,user_name:r}).success(function(e){n.data.publish.comments.push(e);console.log(e)}).error(function(e){n.formError="Your review has not been saved, please try again"});return false};n.editComment=function(e){console.log(e);e=n.data.publish.comments.length-e-1;var t=n.data.publish.comments[e];console.log(t)};n.popupEditForm=function(e){e=n.data.publish.comments.length-e-1;var t=n.data.publish.comments[e];var o=r.open({templateUrl:"/editModal/editModal.view.html",controller:"editModalCtrl as vm",resolve:{commentData:function(){return{publishid:n.publishid,comm:t}}}});o.result.then(function(t){n.data.publish.comments[e]=t})};n.popupDeleteForm=function(e){e=n.data.publish.comments.length-e-1;var t=n.data.publish.comments[e];var o=r.open({templateUrl:"/deleteModal/deleteModal.view.html",controller:"deleteModalCtrl as vm",resolve:{commentData2:function(){return{publishid:n.publishid,comm:t}}}});o.result.then(function(e){$route.reload()})}}})();(function(){angular.module("lyricsShareApp").controller("publishCreateCtrl",e);e.$inject=["$location","publishCreate","authentication"];function e(e,t,r){var o=this;o.pageHeader={title:"Create a new Publish"};o.body={user_name:r.currentUser().name,titulo:"",genres:"",autor:"",album:"",track:"",lyrics:""};o.returnPage="/";o.onSubmit=function(){o.formError="";if(!o.body.user_name||!o.body.titulo||!o.body.lyrics||!o.body.track){o.formError="All fields required, please try again";return false}else{o.doCreate(o.body)}};o.doCreate=function(r){o.formError="";t.create(r).then(function(){e.path(o.returnPage)})}}})();(function(){angular.module("lyricsShareApp").controller("editModalCtrl",e);e.$inject=["$modalInstance","lyricsShareData","commentData"];function e(e,t,r){var o=this;o.commentData=r;console.log(r);o.onSubmit=function(){o.formError="";if(!o.formData.post){o.formError="Espacio en blanco, no aceptado";return false}else{o.doUpdateComment(o.commentData.publishid,o.commentData.comm._id,o.formData)}};o.doUpdateComment=function(e,r,n){t.updateComment(e,r,{post:n.post,user_name:o.commentData.comm.user_name}).success(function(e){o.modal.close(e)}).error(function(e){o.formError="Error, no saved"});return false};o.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("lyricsShareApp").controller("deleteModalCtrl",e);e.$inject=["$modalInstance","lyricsShareData","commentData2"];function e(e,t,r){var o=this;o.commentData2=r;console.log(r);o.onDSubmit=function(){o.doDeleteComment(o.commentData2.publishid,o.commentData2.comm._id)};o.doDeleteComment=function(e,r){t.deleteComment(e,r).success(function(e){o.modal.close(e)}).error(function(e){o.formError="Error, no saved"});return false};o.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("lyricsShareApp").service("lyricsShareData",e);e.$inject=["$http"];function e(e){var t=function(){return e.get("/api/publish")};var r=function(t){return e.get("/api/publish/"+t)};var o=function(t,r){return e.post("/api/publish/"+t+"/comment",r)};var n=function(t,r,o){return e.put("/api/publish/"+t+"/comment/"+r,o)};var a=function(t,r){return e.delete("/api/publish/"+t+"/comment/"+r)};return{listPublishById:t,publishById:r,createComment:o,updateComment:n,deleteComment:a}}})();(function(){angular.module("lyricsShareApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var r=function(e){t.localStorage["lyricsShare-token"]=e};var o=function(){return t.localStorage["lyricsShare-token"]};var n=function(){var e=o();if(e){var r=JSON.parse(t.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var a=function(){if(n()){var e=o();var r=JSON.parse(t.atob(e.split(".")[1]));return{email:r.email,name:r.name}}};register=function(t){return e.post("/api/registro",t).success(function(e){r(e.token)})};login=function(t){return e.post("/api/login",t).success(function(e){r(e.token)})};logout=function(){t.localStorage.removeItem("lyricsShare-token")};return{currentUser:a,saveToken:r,getToken:o,isLoggedIn:n,register:register,login:login,logout:logout}}})();(function(){angular.module("lyricsShareApp").service("publishCreate",e);e.$inject=["$http","$window"];function e(e,t){create=function(t){var r=e.post("/api/publish",t).success(function(e){console.log({image:t.image,name:e._id})});return r};return{create:create}}})();(function(){angular.module("lyricsShareApp").controller("navigationCtrl",e);e.$inject=["$location","$route","authentication"];function e(e,t,r){var o=this;o.currentPath=e.path();o.isLoggedIn=r.isLoggedIn();o.currentUser=r.currentUser();o.logout=function(){r.logout();e.path("/");t.reload()}}})();(function(){angular.module("lyricsShareApp").directive("fileModel",e);e.$inject=["$parse"];function e(e){return{restrict:"A",link:function(t,r,o){var n=e(o.fileModel);var a=n.assign;r.bind("change",function(){t.$apply(function(){a(t,r[0].files[0])})})}}}})();(function(){angular.module("lyricsShareApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("lyricsShareApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();